[tasks.list-tool-backends]
description = "Show the backend for each tool managed by mise"
run = '''
mise ls | awk '{print $1}' | xargs -n1 mise tool | grep '^Backend:'
'''

[tasks.pr-complete]
description = "Create PR, view details, review diff with delta, and merge"
run = '''
gh pr create && gh pr view && read -p "Press Enter to view diff..." _ && gh pr diff | delta && gh pr merge && lazygit
'''

[tasks.gh-manage]
description = "Interactive GitHub issue/PR manager with gum"
run = '''
# Issue か PR かを選択
target=$(printf "issue\npr" | gum choose)

if [ -z "$target" ]; then
  exit 0
fi

while true; do
  # Issue または PR の一覧を表示
  item=$(gh "$target" ls | gum filter)

  if [ -z "$item" ]; then
    exit 0
  fi

  number=$(echo "$item" | awk '{print $1}')

  # 操作に応じた選択肢を設定
  if [ "$target" = "issue" ]; then
    operations="view\nedit\ncomment\nclose\nback"
  else
    operations="view\ncheckout\ndiff\nedit\ncomment\nmerge\nready\nclose\nback"
  fi

  while true; do
    operation=$(printf "$operations" | gum choose)

    if [ -z "$operation" ]; then
      exit 0
    fi

    if [ "$operation" = "back" ]; then
      break
    fi

    gh "$target" "$operation" "$number"
    read -p "Press Enter to continue..." _
  done
done
'''

[tasks.copilot-write]
description = "Launch GitHub Copilot CLI with write tool enabled"
run = "copilot --allow-tool 'write' --model claude-haiku-4.5"

[tasks.tree]
description = "Show directory tree (ignore .git)"

usage = '''
arg "<depth>" help="Max depth (omit to show all levels)" default=""
'''

run = '''
# depth が指定されていれば -maxdepth を付ける
# 未指定なら全階層を表示する
if [ -n "${usage_depth}" ]; then
  maxdepth_arg="-maxdepth ${usage_depth}"
else
  maxdepth_arg=""
fi

# .git ディレクトリは探索対象から除外して一覧を出す
find . ${maxdepth_arg} \
  -name .git -prune -o \
  -print |
sed '
  # 「/」で区切られたパス要素を縦線インデントに置き換える
  s;[^/]*/;│   ;g

  # 行末のファイル名（最後の要素）を枝（├──）付きで表示する
  s;│   \([^│]*\)$;├── \1;
'
'''

[settings]
windows_default_inline_shell_args = "C:/Progra~1/Git/bin/bash.exe --noprofile -c"
