[tasks.list-tool-backends]
description = "Show the backend for each tool managed by mise"
run = '''
mise ls | awk '{print $1}' | xargs -n1 mise tool | grep '^Backend:'
'''

[tasks.vcs-manage]
description = "Interactive VCS (GitHub/GitLab) manager with gum"
run = '''
# リモートURLからVCSプロバイダーを判定
remote_url=$(git config get remote.origin.url)

if echo "$remote_url" | grep -q "gitlab"; then
  vcs_cli="glab"
  vcs_name="GitLab"
elif echo "$remote_url" | grep -q "github"; then
  vcs_cli="gh"
  vcs_name="GitHub"
else
  echo "Error: Unable to determine VCS provider (GitHub or GitLab) from remote URL: $remote_url"
  exit 1
fi

while true; do
  # issue/pr,mr/quitを選択（そのままコマンド実行に使うためすべて小文字）
  if [ "$vcs_name" = "GitLab" ]; then
    resource_options="issue\nmr\nquit"
  else
    resource_options="issue\npr\nquit"
  fi

  target=$(printf "$resource_options" | gum choose --header "Select $vcs_name resource type")

  # 未選択またはQuit選択でスクリプトを終了
  if [ -z "$target" ] || [ "$target" = "quit" ]; then
    exit 0
  fi

  while true; do
    # コマンド入力を受け付ける
    command=$(gum input --prompt "$vcs_cli ${target}> " --header "Type 'exit' to return to selection")

    # 未入力の場合はエラーを表示して続行
    if [ -z "$command" ]; then
      echo "Please enter a command (or type 'exit' to return)"
      echo "---"
      continue
    fi

    # exitで選択画面に戻る
    if [ "$command" = "exit" ]; then
      break
    fi

    # コマンド実行（|| true でエラー時もスクリプトを続行）
    eval "$vcs_cli $target $command" || true
    echo "---"
  done
done
'''

[tasks.copilot-write]
description = "Launch GitHub Copilot CLI with write tool enabled"
run = '''
mode=$(printf "new\ncontinue\nresume" | gum choose --header "Select mode:")
if [ -z "$mode" ]; then
  exit 0
fi
if [ "$mode" = "continue" ]; then
  copilot --allow-tool 'write' --model claude-haiku-4.5 --continue
elif [ "$mode" = "resume" ]; then
  copilot --allow-tool 'write' --model claude-haiku-4.5 --resume
else
  copilot --allow-tool 'write' --model claude-haiku-4.5
fi
'''

[settings]
windows_default_inline_shell_args = "C:/Progra~1/Git/bin/bash.exe --noprofile -c"
